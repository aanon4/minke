
# Static IP assigned to MinkeBox
IP=192.168.51.14

# MinkeBox runs onto of it's own network called 'home'. This is bridge to the host network and will be created if
# it doesn't exist.
if [ "$(docker network inspect home 2> /dev/null)" = "[]" ]; then
  default_route=$(ip route get 1.1.1.1 | head -1)
  gw=$(echo $default_route | cut -d' ' -f3)
  dev=$(echo $default_route | cut -d' ' -f5)
  host=$(echo $default_route | cut -d' ' -f7)
  docker network create --driver=bridge --subnet=${host}/24 --gateway=${host} -o "com.docker.network.bridge.name=${dev}" -o "com.docker.network.bridge.enable_ip_masquerade=false" --aux-address="DefaultGatewayIPv4=${gw}" home
fi

docker container rm minke 2> /dev/null
docker run --name minke -d --privileged \
  -v /var/run/docker.sock:/var/run/docker.sock \
  -v /minke:/minke \
  --network=home \
  --ip=${IP} \
  registry.minkebox.net/minkebox/minke

