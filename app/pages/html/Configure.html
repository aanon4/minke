<!DOCTYPE html>
<html class="configure {{#if adminMode}}admin-mode{{/if}}">
  <head>
    <link href="/css/configure.css" rel="stylesheet" type="text/css">
    <link href="/css/pure.css" rel="stylesheet" type="text/css">
    <script src="/js/script.js" type="text/javascript"></script>
    {{#if adminMode}}<script src="/js/ace.js" type="text/javascript"></script>{{/if}}
  </head>
  <body>
    <div class="pure-g">
      {{#with skeleton}}
      <div class="sidebar pure-u-1">
        <div class="header">            
          <div class="name" contenteditable="true" placeholder="{{name}}" oninput="action('Name',this.innerText)">{{value}}</div>
          <h2 class="description">{{description}}</h2>
          <nav>
            <a class="pure-button admin-only" onclick="setEditMode(null)||cmd('app.save')">Edit</a>
            <a class="pure-button" onclick="cmd('app.restart')">Restart</a>
            <a class="pure-button" data-popbox-target="delete">Delete</a>
          </nav>
        </div>
      </div>
      <div class="content pure-u-1">
        <form class="actions pure-form pure-form-aligned">
          <div class="section visible">
          {{#each actions}}
          {{#if (eq type "Header")}}
          </div>
          <div class="section visible" {{#if id}}id="{{id}}"{{/if}}>
          <div class="content-header">{{title}}</div>
          {{/if}}
          {{#if (eq type "Text")}}
          <div class="content-text">{{text}}</div>
          {{/if}}
          {{#if (eq type "Environment")}}
          <div class="action environment pure-control-group">
            <label class="description">{{description}}</label>
            {{#if options}}
            <select class="value" onchange="{{action}}">
              {{#each options}}
              <option value="{{value}}" {{#if (eq value ../value)}}selected{{/if}}>{{name}}</option>
              {{/each}}
            </select>
            {{else}}
            <input class="pure-input-rounded pure-u-16-24 value" type="text" spellcheck="false" placeholder="{{placeholder}}" value="{{value}}" oninput="{{action}}">
            {{/if}}
          </div>
          {{/if}}
          {{#if (eq type "Argument")}}
          <div class="action argument pure-control-group">
            <label class="description">{{description}}</label>
            <input class="value" type="text" placeholder="{{placeholder}}" value="{{value}}" oninput="{{action}}">
          </div>
          {{/if}}
          {{#if (eq type "Share")}}
          <div class="action share pure-control-group">
            <label class="description">{{description}}</label>
            <input class="value" type="checkbox" {{#if value}}checked{{/if}} onchange="{{action}}">
          </div>
          {{/if}}
          {{#if (eq type "File")}}
          <div class="action file pure-control-group">
            <label class="description">{{description}}</label>
            <div class="value pure-input-rounded pure-u-16-24" spellcheck="false" contenteditable="true" oninput="{{action}}">{{value}}</div>
          </div>
          {{/if}}
          {{#if (eq type "NAT")}}
          <div class="action nat pure-control-group">
            <label class="description">{{description}}</label>
            <input class="value" type="checkbox" {{#if value}}checked{{/if}} onchange="{{action}}">
          </div>
          {{/if}}
          {{#if (eq type "Network")}}
          <div class="action network pure-control-group">
            <label class="description">{{description}}</label>
            <select onchange="{{action}}">
              {{#each networks}}
              <option {{#if (eq ../value _id)}}selected{{/if}}>{{name}}</option>
              {{/each}}
            </select>
          </div>
          {{/if}}
          {{#if (eq type "Table")}}
          <div class="action table pure-control-group">
            <label class="description">{{description}}</label>
            <table class="pure-table pure-table-horizontal pure-input-rounded pure-u-16-24" oninput="saveTable('{{action}}',this)" onclick="addRmTableRow('{{action}}',window.event)">
              <thead>
                <tr>
                  {{#each headers}}
                  <th>{{this}}</th>
                  {{/each}}
                  {{#if controls}}<th class="control"><span class="add">+</span></th>{{/if}}
                </tr>
              </thead>
              <tbody>
                {{#each value}}
                <tr>
                  {{#each this}}
                  <td contenteditable="true">{{this}}</td>
                  {{/each}}
                  {{#if ../controls}}<td class="control"><span class="remove">&minus;</span></td>{{/if}}
                </tr>
                {{/each}}
              </tbody>
            </table>
          </div>
          {{/if}}
          {{#if (eq type "Shareables")}}
          <div class="action shareables pure-control-group">
            <label class="description">{{description}}</label>
            <div class="shares pure-u-16-24">
              {{#each shareables}}
              {{#each shares}}
              <div class="share">
                <label class="description">{{target}}</label>
                <input class="value" type="checkbox" {{#if value}}checked{{/if}} onchange="{{action}}">
              </div>
              {{/each}}
              {{/each}}
            </div>
          </div>
          {{/if}}
          {{else}}
          <div class="content-header">Nothing to configure</div>
          {{/each}}
          </div>
        </form>
      {{/with}}
        <div class="skeleton">
          <div class="content-header">Skeleton</div>
          <div class="editor">{{skeletonAsText}}</div>
        </div>
      </div>
    </div>
    <div data-popbox-id="delete" class="popbox">
      <div class="popbox_container">
        <div class="content-header">Delete Application</div>
        <div class="content-text">
          Are you sure you want to delete this application?
        </div>
        <div class="content-text">
          It will also remove this application's data, including any data which is shared.
        </div>
        <div class="spacer">
          <button class="pure-button button-delete-app" data-popbox-close="delete">Yes</button>
          <button class="pure-button button-no" data-popbox-close="delete">No</button>
        </div>
      </div>
    </div>
    <script>
      setActionProperties({{{properties}}});
      registerVisibles({{{visibles}}});
      const popbox = new Popbox({ blur:false, overlay:true });
      document.addEventListener('popbox_closing', (e) => {
        if (e.detail.source.classList.contains('button-delete-app')) {
          cmd('app.delete');
          window.parent.closeInlinePage();
        }
      });
    </script>
  </body>
</html>
