<!DOCTYPE html>
<html class="configure {{#if adminMode}}admin-mode{{/if}}">
  <head>
    <link href="/css/configure.css" rel="stylesheet" type="text/css">
    <link href="/css/pure.css" rel="stylesheet" type="text/css">
    <script src="/js/script.js" type="text/javascript"></script>
    {{#if adminMode}}<script src="/js/ace.js" type="text/javascript"></script>{{/if}}
  </head>
  <body>
    <div class="pure-g">
      {{#with skeleton}}
      <div class="sidebar pure-u-1">
        <div class="header">            
          <div class="name" contenteditable="true" placeholder="{{name}}" oninput="action('Name',this.innerText)">{{value}}</div>
          <h2 class="description">{{{description}}}</h2>
          <nav>
            {{#unless ../minkeConfig}}
            <a class="pure-button admin-only" onclick="setEditMode(null)||cmd('app.save')">Edit</a>
            {{/unless}}
            <a class="pure-button" onclick="cmd('app.restart')">Restart</a>
            {{#unless ../minkeConfig}}
            <a class="pure-button" data-popbox-target="delete">Delete</a>
            {{/unless}}
          </nav>
        </div>
      </div>
      <div class="content pure-u-1">
        <form class="actions pure-form pure-form-aligned">
          <div class="section">
          {{#each actions}}
          {{#if (eq type "Header")}}
          </div>
          <div class="section" {{#if vid}}id="{{vid}}"{{/if}}>
          <div class="content-header">{{title}}</div>
          {{else if (eq type "Text")}}
          <div class="content-text">{{{text}}}</div>
          {{else if (eq type "Environment")}}
          <div class="action environment table pure-control-group">
            <label class="description">{{{description}}}</label>
            {{#if (eq style "Table")}}
            {{> Table}}
            {{else if (eq style "Checkbox")}}
            <input {{#if eid}}id="{{eid}}"{{/if}} class="value" type="checkbox" {{#if value}}checked{{/if}} onchange="{{action}}">
            {{else}}
            {{#if options}}
            <select {{#if eid}}id="{{eid}}"{{/if}} class="value" onchange="{{action}}">
              {{#each options}}
              <option value="{{value}}" {{#if (eq value ../value)}}selected{{/if}}>{{name}}</option>
              {{/each}}
            </select>
            {{else}}
            <input {{#if eid}}id="{{eid}}"{{/if}} class="pure-input-rounded pure-u-16-24 value" type="text" spellcheck="false" placeholder="{{placeholder}}" value="{{value}}" oninput="{{action}}">
            {{/if}}
            {{/if}}
          </div>
          {{else if (eq type "Argument")}}
          <div class="action argument pure-control-group">
            <label class="description">{{{description}}}</label>
            <input class="value" type="text" placeholder="{{placeholder}}" value="{{value}}" oninput="{{action}}">
          </div>
          {{else if (eq type "File")}}
          <div class="action file table pure-control-group">
            <label class="description">{{{description}}}</label>
            {{#if (eq style "Download")}}
            {{#if value}}
            <a id="{{name}}" class="pure-button pure-button-primary">Download</a>
            <script>
              const a = document.getElementById("{{name}}");
              const url = URL.createObjectURL(new Blob([ `{{{value}}}` ], { type: 'text/plain' }));
              a.href = url;
              a.download = "{{filename}}";
            </script>
            {{else}}
            <input class="pure-button pure-button-active" type="button" disabled value="Download">
            {{/if}}
            {{else if (eq style "Inline")}}
            <textarea class="value pure-input-rounded pure-u-16-24" spellcheck="false" oninput="{{action}}">{{value}}</textarea>
            {{else if (eq style "Table")}}
            {{> Table}}
            {{/if}}
          </div>
          {{else if (eq type "NAT")}}
          <div class="action nat pure-control-group">
            <label class="description">{{{description}}}</label>
            <input class="value" type="checkbox" {{#if value}}checked{{/if}} onchange="{{action}}">
          </div>
          {{else if (eq type "Network")}}
          <div class="action network pure-control-group">
            <label class="description">{{{description}}}</label>
            <select onchange="{{action}}">
              {{#each networks}}
              {{#if _id}}
              <option value="{{_id}}" {{#if (eq ../value _id)}}selected{{/if}}>{{name}}</option>
              {{/if}}
              {{/each}}
            </select>
          </div>
          {{else if (eq type "Shareables")}}
          <div class="action shareables pure-control-group">
            {{#if shareables}}
            <label class="description">{{{description}}}</label>
            {{> Shareables}}
            {{else}}
            <div style="text-align: center">No applications sharing.</div>
            {{/if}}
          </div>
          {{else if (eq type "CustomShareables")}}
          <div class="action shareables pure-control-group">
            <label class="description">{{{description}}}</label>
            {{> CustomShareables}}
          </div>
          {{/if}}
          {{else}}
          <div class="content-header">Nothing to configure</div>
          {{/each}}
          </div>
        </form>
      {{/with}}
        <div class="skeleton">
          <div class="content-header">Skeleton</div>
          <div class="editor">{{skeletonAsText}}</div>
        </div>
      </div>
    </div>
    <div data-popbox-id="delete" class="popbox">
      <div class="popbox_container">
        <div class="content-header">Delete Application</div>
        <div class="content-text">
          Are you sure you want to delete this application?
        </div>
        <div class="content-text">
          It will also remove this application's data, including any data which is shared.
        </div>
        <div class="spacer">
          <button class="pure-button button-delete-app" data-popbox-close="delete">Yes</button>
          <button class="pure-button button-no" data-popbox-close="delete">No</button>
        </div>
      </div>
    </div>
    <script>
      setActionProperties({{{properties}}});
      registerChanges({{{changes}}});
      const popbox = new Popbox({ blur:false, overlay:true });
      document.addEventListener('popbox_closing', (e) => {
        if (e.detail.source.classList.contains('button-delete-app')) {
          cmd('app.delete');
          window.parent.closeInlinePage();
        }
      });
    </script>
  </body>
</html>
