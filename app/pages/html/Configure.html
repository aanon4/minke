<!DOCTYPE html>
<html class="configure {{#if Advanced}}advanced-mode{{/if}}">
  <head>
    <link href="/css/configure.css" rel="stylesheet" type="text/css">
    <link href="/css/pure.css" rel="stylesheet" type="text/css">
    <script src="/js/script.js" type="text/javascript"></script>
    {{#if Advanced}}<script src="/js/ace.js" type="text/javascript"></script>{{/if}}
  </head>
  <body>
    <div class="pure-g">
      {{#with skeleton}}
      <div class="sidebar pure-u-1">
        <div class="header">
          {{#if skeletonType}}
            <div class="skeleton-type">{{skeletonType}}</div>
          {{/if}}
          <div class="name">
            <input size="25" type="text" placeholder="{{name}}" oninput="action('Name',this.value)" value="{{value}}">
          </div>
          <h2 class="description">{{{description}}}</h2>
          <nav>
            {{#if ../minkeConfig}}
            {{#if ../help}}<a class="pure-button" onclick="toggleHelp()">Help</a>{{/if}}
            <a class="pure-button admin-only" data-popbox-target="restart">Restart</a>
            <a class="pure-button" data-popbox-target="reboot">Reboot</a>
            <a class="pure-button" data-popbox-target="halt">Power Off</a>
            {{else}}
            {{#if ../link}}<a class="pure-button" href="{{../link}}" target="_blank">Open App</a>{{/if}}
            <a class="pure-button admin-only" onclick="setEditMode(null)||cmd('app.save')">Edit</a>
            {{#if ../help}}<a class="pure-button" onclick="toggleHelp()">Help</a>{{/if}}
            <a class="pure-button" onclick="cmd('app.restart');this.innerText='Restart'">{{#if ../firstUse}}Start{{else}}Restart{{/if}}</a>
            <a class="pure-button" data-popbox-target="delete">Delete</a>
            {{/if}}
          </nav>
        </div>
      </div>
      <div class="content pure-u-1">
        <form class="actions pure-form pure-form-aligned">
          <div class="section">
          {{#each actions}}
          {{#if (eq type "Header")}}
          </div>
          <div class="section {{#if visible}}invisible{{/if}}" {{#if id}}id="{{id}}"{{/if}}>
          <div class="content-header">{{title}}</div>
          {{else if (eq type "Text")}}
          <div class="content-text {{#if visible}}invisible{{/if}}" {{#if id}}id="{{id}}"{{/if}}>{{{text}}}</div>
          {{else if (eq type "Help")}}
          <div class="help-text {{#if visible}}invisible{{/if}}" {{#if id}}id="{{id}}"{{/if}}><div class="help-text-content">{{{text}}}</div></div>
          {{else if (eq type "Environment")}}
          <div {{#if id}}id="{{id}}"{{/if}} class="action environment table pure-control-group {{#if visible}}invisible{{/if}}">
            <label class="description">{{{description}}}</label>
            {{#if (eq style "Table")}}
            {{> Table}}
            {{else if (eq style "Checkbox")}}
            <input class="value can-disable" type="checkbox" onchange="{{action}}" {{#if value}}checked{{/if}}>
            {{else if (eq style "Websites")}}
            {{> Websites}}
            {{else}}
            {{#if options}}
            <select class="value can-disable" onchange="{{action}}">
              {{#each options}}
              <option value="{{value}}" {{#if (eq value ../value)}}selected{{/if}}>{{name}}</option>
              {{/each}}
            </select>
            {{else}}
            <input class="pure-input-rounded pure-u-16-24 value can-disable" type="text" spellcheck="false" placeholder="{{placeholder}}" value="{{value}}" oninput="{{action}}" {{#if validate}}pattern="^{{validate}}$"{{/if}}>
            {{/if}}
            {{/if}}
          </div>
          {{else if (eq type "Argument")}}
          <div {{#if id}}id="{{id}}"{{/if}} class="action argument pure-control-group {{#if visible}}invisible{{/if}}">
            <label class="description">{{{description}}}</label>
            <input class="value" type="text" placeholder="{{placeholder}}" value="{{value}}" oninput="{{action}}">
          </div>
          {{else if (eq type "File")}}
          <div {{#if id}}id="{{id}}"{{/if}} class="action file table pure-control-group {{#if visible}}invisible{{/if}}">
            <label class="description">{{{description}}}</label>
            {{#if (eq style "Download")}}
            {{> Download}}
            {{else if (eq style "Inline")}}
            <textarea class="can-disable value pure-input-rounded pure-u-16-24" spellcheck="false" oninput="{{action}}">{{value}}</textarea>
            {{else if (eq style "Table")}}
            {{> Table}}
            {{else if (eq style "RTable")}}
            {{> RTable}}
            {{/if}}
          </div>
          {{else if (eq type "NAT")}}
          <div {{#if id}}id="{{id}}"{{/if}} class="action nat pure-control-group {{#if visible}}invisible{{/if}}">
            <label class="description">{{{description}}}</label>
            <input class="value" type="checkbox" {{#if value}}checked{{/if}} onchange="{{action}}">
          </div>
          {{else if (eq type "Network")}}
          <div {{#if id}}id="{{id}}"{{/if}} class="action network pure-control-group {{#if visible}}invisible{{/if}}">
            <label class="description">{{{description}}}</label>
            <select onchange="{{action}}">
              {{#each networks}}
              {{#if _id}}
              <option value="{{_id}}" {{#if (eq ../value _id)}}selected{{/if}}>{{name}}</option>
              {{/if}}
              {{/each}}
            </select>
          </div>
          {{else if (eq type "Directory")}}
          <div {{#if id}}id="{{id}}"{{/if}} class="action shareables pure-control-group {{#if visible}}invisible{{/if}}">
            {{#if shareables}}
            <label class="description">{{{description}}}</label>
            {{> Directory}}
            {{else}}
            <div style="text-align: center">No applications sharing.</div>
            {{/if}}
          </div>
          {{else if (eq type "Shareables")}}
          <div {{#if id}}id="{{id}}"{{/if}} class="action shareables pure-control-group {{#if visible}}invisible{{/if}}">
            {{#if shareables}}
            <label class="description">{{{description}}}</label>
            {{> Shareables}}
            {{else}}
            <div style="text-align: center">No applications sharing.</div>
            {{/if}}
          </div>
          {{else if (eq type "CustomShareables")}}
          <div {{#if id}}id="{{id}}"{{/if}} class="action shareables pure-control-group {{#if visible}}invisible{{/if}}">
            <label class="description">{{{description}}}</label>
            {{> CustomShareables}}
          </div>
          {{else if (eq type "__Disks")}}
          <div class="action disks pure-control-group">
            {{> Disks}}
          </div>
          {{else if (eq type "__BackupAndRestore")}}
          <div class="action disks pure-control-group">
            {{> BackupAndRestore}}
          </div>
          {{/if}}
          {{else}}
          <div class="content-header">Nothing to configure</div>
          {{/each}}
          </div>
        </form>
      {{/with}}
        <div class="skeleton">
          <div class="content-header">Skeleton</div>
          <div class="editor">{{skeletonAsText}}</div>
          <a class="pure-button" onclick="saveSkeleton()">Save to Disk</a>
        </div>
      </div>
    </div>
    <div data-popbox-id="delete" class="popbox">
      <div class="popbox_container">
        <div class="content-header">Delete Application</div>
        <div class="content-text">
          Are you sure you want to delete this application?
        </div>
        <div class="content-text">
          It will also remove this application's data, including any data which is shared.
        </div>
        <div class="spacer">
          <button class="pure-button button-delete-app" data-popbox-close="delete">Yes</button>
          <button class="pure-button button-no" data-popbox-close="delete">No</button>
        </div>
      </div>
    </div>
    <div data-popbox-id="restart" class="popbox">
      <div class="popbox_container">
        <div class="content-header">Restart</div>
        <div class="content-text">
          Are you sure you want to restart Minke? Applications may become temporarily unavailable.
        </div>
        <div class="spacer">
          <button class="pure-button button-restart" data-popbox-close="restart">Restart</button>
          <button class="pure-button button-no" data-popbox-close="restart">No</button>
        </div>
      </div>
    </div>
    <div data-popbox-id="reboot" class="popbox">
      <div class="popbox_container">
        <div class="content-header">Reboot</div>
        <div class="content-text">
          Are you sure you want to reboot the machine?
        </div>
        <div class="spacer">
          <button class="pure-button button-reboot" data-popbox-close="reboot">Reboot</button>
          <button class="pure-button button-no" data-popbox-close="reboot">No</button>
        </div>
      </div>
    </div>
    <div data-popbox-id="halt" class="popbox">
      <div class="popbox_container">
        <div class="content-header">Power Off</div>
        <div class="content-text">
          Are you sure you want to power off the machine?
        </div>
        <div class="spacer">
          <button class="pure-button button-halt" data-popbox-close="halt">Power Off</button>
          <button class="pure-button button-no" data-popbox-close="halt">No</button>
        </div>
      </div>
    </div>
    <script>
      setActionProperties({{{properties}}});
      registerChanges({{{changes}}});
      const popbox = new Popbox({ blur:false, overlay:true });
      document.addEventListener('popbox_closing', (e) => {
        if (e.detail.source.classList.contains('button-delete-app')) {
          cmd('app.delete');
          window.parent.closeInlinePage();
        }
        else if (e.detail.source.classList.contains('button-restart')) {
          cmd('app.restart');
          window.parent.closeInlinePage();
        }
        else if (e.detail.source.classList.contains('button-reboot')) {
          cmd('app.reboot');
          window.parent.closeInlinePage();
        }
        else if (e.detail.source.classList.contains('button-halt')) {
          cmd('app.halt');
          window.parent.closeInlinePage();
        }
      });
    </script>
  </body>
</html>
